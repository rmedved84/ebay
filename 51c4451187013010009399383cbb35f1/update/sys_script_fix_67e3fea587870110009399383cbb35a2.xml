<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_fix">
    <sys_script_fix action="INSERT_OR_UPDATE">
        <before>false</before>
        <description/>
        <name>Fix Listings</name>
        <record_for_rollback>true</record_for_rollback>
        <script><![CDATA[
var today = new GlideDate();
var endTime = today.getDisplayValue() + 'T00:00:00.000Z';
today.addDaysLocalTime(-120);
var startTime = today.getDisplayValue() + 'T00:00:00.000Z';
var listings = EbayUtil.getListings(startTime, endTime, 1);
var totalPages = parseInt(listings.GetSellerListResponse.PaginationResult.TotalNumberOfPages);
listingsWithNewSku = [];
doIt(listings);

for(var i = 2; i < totalPages + 1; i++){
  listings = EbayUtil.getListings(startTime, endTime, i);
  doIt(listings)
}

function doIt(listings) {
    listings = listings.GetSellerListResponse.ItemArray.Item;
  gs.info(listings[0])
    for (var j = 0; j < listings.length; j++) {
        if (listings[j].SKU && listings[j].SKU.toLowerCase().indexOf('inv') == -1) {
            var itemGR = new GlideRecord('x_476139_ebay_item');
          itemGR.addNullQuery('legacy_listing_id')
          itemGR.addQuery('number', listings[j].SKU);
          itemGR.query();
          while(itemGR.next()){
            itemGR.setValue('legacy_listing_id', listings[j].ItemID);
            itemGR.setValue('name', listings[j].Title);
            itemGR.update();
          }
        }
    }
}
]]></script>
        <sys_class_name>sys_script_fix</sys_class_name>
        <sys_created_by>rmedved</sys_created_by>
        <sys_created_on>2022-04-24 03:48:38</sys_created_on>
        <sys_id>67e3fea587870110009399383cbb35a2</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>Fix Listings</sys_name>
        <sys_package display_value="Ebay" source="x_476139_ebay">51c4451187013010009399383cbb35f1</sys_package>
        <sys_policy/>
        <sys_scope display_value="Ebay">51c4451187013010009399383cbb35f1</sys_scope>
        <sys_update_name>sys_script_fix_67e3fea587870110009399383cbb35a2</sys_update_name>
        <sys_updated_by>rmedved</sys_updated_by>
        <sys_updated_on>2022-04-24 03:50:41</sys_updated_on>
        <unloadable>false</unloadable>
    </sys_script_fix>
</record_update>
